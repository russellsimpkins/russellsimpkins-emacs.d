/************************************************/
/**
 * A simple way to do debugging. It expects that you have
 * a div or span that id='debug'
 */
function debug(msg) {
    $('debug').set('html',$('debug').get('html') + msg);
}
/**
 * This was from omni grid
 * @param evt
 * @return
 */
function onGridSelect(evt) {
     var str = 'row: '+ evt.row +' indices: '+evt.indices;
     str += ' id: '+evt.target.getDataByRow(evt.row).id;

     //prompt( 'grid data', str );
}
/**
 * Not used right now, was from omni grid examples
 */
function gridButtonClick(button, grid) {
    //alert(button);
}
/**
 * A function to delete a row.
 * @return
 */
function deleteSelectedRow() {
    var indices = datagrid.getSelectedIndices();
    data = datagrid.getDataByRow(indices[0]);
    if (data.child_id) {
        params = {
            id: data.child_id,
            _action: 'delete'
        };
        url = datagrid.options.childUrl;
    } else {
        params = {
            id: data.id,
            _action: 'delete'
        };
        url = datagrid.options.url;
    }
    
    var request = new Request.JSON( {
        url : url,
        data : params
    });
    request.addEvent("complete", function(e) {
        datagrid.refresh();
    });
    request.send();
}

/**
 * This function is called on a callback from a formpost to a hidden
 * iframe.
 * @param id - the id that was created or updated
 * @return
 */
function onSuccess(id) {
    //alert("We saved: " +id);
    datagrid.refresh();
}
/**
 * This function is called on a callback from a formpost to a hidden iframe.
 * @param id - the id that failed to update/delete
 * @return
 */
function onFailure(id) {
    alert("Unable to update the record for some reason.");
}
/**
 * This will build an html form to edit the data fields.
 * @param obj
 * @return
 */
function showEditForm(obj) {

    var data = new Hash(datagrid.getDataByRow(obj.row));
    formWrapper = getWrapper('editForm','editForm');
    editForm = buildForm('update','get','/cms/action/actionSubmission.php');
    editForm.setAttribute('target','forpost');
    
    // add a submit button
    save = buildInput('save','save submission','','save');
    save.setAttribute('type','button');
    save.setAttribute('onclick',"fireEvent('click',this)");
    save.addEvent('click', function(event) {
            parent = this.getParent().getParent();
            parent.submit();
    });
    
    // set the action for out php controller
    action = buildInput('_action','update',0,'');
    action.setAttribute('type','hidden');
    
    saveRow = new Element("div", {
        'class':'buttonRow'
    });
    saveRow.appendChild(save);
    saveRow.appendChild(action);
    editForm.appendChild(saveRow);
    
    // build a form with all fields.
    cmu.each(function (el) {
            if (!el.dataIndex.match(/^child_/)) { 
                row = makeRow(el,data);
                editForm.appendChild(row);
            }
    });
    /* I want to have a button on the top and bottom, but it
     * isn't working correctly - commenting out for now.**/
    // add a submit button
    bsave = buildInput('save','save submission','','save');
    bsave.setAttribute('type','button');
    // not sure why i have to do it this way... but it worked.
    bsave.setAttribute('onclick',"fireEvent('click',this)");
    bsave.addEvent('click', function(event) {
            parent = this.getParent().getParent();
            parent.submit();
    });
    bsaveRow = new Element("div", {
        'class':'buttonRow'
    });
    bsaveRow.appendChild(bsave);
    editForm.appendChild(bsaveRow);
    
    formWrapper.appendChild(editForm);
    wrapper=getWrapper('sample','sample');
    wrapper.appendChild(formWrapper);
    obj.parent.appendChild(wrapper);
    /*****************************************/
    /**
     * Build up mini forms for each child.
     */
    if (data.child_id) {
        
        childWrapper = getWrapper('editForm','editForm');
        childForm = buildForm('update'+data.child_id,'get','/cms/action/actionChildren.php');
        childForm.setAttribute('target','forpost');
        
        // add a submit button
        csave = buildInput('save'+data.child_id,'save child','','save');
        csave.setAttribute('type','button');

        // not sure why i have to do it this way... but it worked.
        csave.addEvent('click', function(event) {
                parent = this.getParent().getParent();
                parent.submit();
        });
        
        // set the action for out php controller
        caction = buildInput('_action','update',0,'');
        caction.setAttribute('type','hidden');
        
        csaveRow = new Element("div", {
            'class':'buttonRow'
        });
        csaveRow.appendChild(csave);
        csaveRow.appendChild(caction);
        childForm.appendChild(csaveRow);
        model = getEmptyChildModel();
        // build a form with all fields.
        model.each(function (el) {
                    
                    // need to make the value names correct...
                    cdata = getChildData(data);
                    cdata['parent_id'] = data.id;
                    row = makeRow(el,cdata);
                    el.editable=false;
                    childForm.appendChild(row);
                
        });
        childWrapper.appendChild(childForm);
    }
    /*****************************************/
    
    // init the date picker box
    $$('input.DatePickers').each( function(el){
        new DatePicker(el, {format: 'm/d/Y', inputOutputFormat: 'm/d/Y', yearPicker: true, allowEmpty: true, startView: 'decades', timePicker:true});
    });
    
    if (data.child_id) {
        obj.parent.appendChild(childWrapper);
    }
    
}
/**
 * This shows how to get the row and the data at that row.
 * @return null
 */
function getSelectedIndices() {
    var indices = datagrid.getSelectedIndices();

    if (indices.length == 0) {
        alert('No selection.');
        return;
    }
    var str = '';
    for (var i=0; i<indices.length; i++) {
        str += 'row: '+indices[i]+' data: '+JSON.encode(datagrid.getDataByRow(indices[i]))+'\n' ;
    }
    alert(str);
}
/**
 * A vary basic accordion. - this is an example
 * @param obj
 * @return
 */
function accordionFunction(obj) {
    obj.parent.set('html', '<div style="padding:5px"> Row '+obj.row+'<br/><br/>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. </div>');
}

/**
 * An example of setting a single data row.
 * @return
 */
function setDataFirstRow() {
    datagrid.setDataByRow(1, {option_id:0, option_name:'ds', blog_id:1});
}

/*************************************************************
 * BEGIN
 * A series of utility methods to construct html elements for
 * the filter bar at the bottom of the screen
 **************************************************************/
/**
 * Creates our wrapper div
 * @return
 */
function getWrapper(clazz,id) {
    wrapper = new Element('div', {
        'class': clazz,
        'id': id
    });
    return wrapper;
}
/**
 * One way to create an html form using javascript
 * @param id - html id attribute. same value will be used for name
 * @param method - get/post
 * @param action - where to get/post to
 * @return
 */
function buildForm(id,method,action) {
    form = document.createElement('FORM');
    form.setAttribute('id',id);
    form.setAttribute('name',id);
    form.setAttribute('method',method);
    form.setAttribute('action',action);
    return form;
}
/**
 * Generic function to create a SELECT html object.
 * @param id - REQUIRED: the id
 * @param items - REQUIRED: this should be a Hash of ['value']='what to display'
 * @param clazz - optional a css class
 * @param values - hash map
 * @return
 */
function buildSelect(id,items,clazz,selected) {
    select =  document.createElement("SELECT");
    select.setAttribute('class',clazz);
    select.setAttribute('id',id);
    select.setAttribute('name',id);
        
    select = new Element('select', {
        'class': clazz,
        'id': id,
        'name': id
    });
    var idx;
    if (select.options == undefined) select.options = new Array();
    items.each(function (value,key,hash) {
        option = new Option();
        option.value=key;
        option.text=value;
        select.options[select.options.length]=option;
        if (key == selected) {
            option.selected=true;
            idx=select.options.length-1;
        }
    });
    // pre-select the select item if the id is passed in
    if (idx) {
        select.set('selectedIndex',idx)
        select.setAttribute('selectedIndex',idx);
        select.options[idx].selected=true;
        select.options[idx].defaultSelected=true;
    }
    return select;
}
/**
 * Build up an HTML INPUT tag
 * @param id REQUIRED - the id
 * @param value optional - default value
 * @param clazz optional - the css class
 * @return
 */
function buildInput(id,value,size,clazz) {
    input =  document.createElement("INPUT");
    input.setAttribute('type','text');
    input.setAttribute('class',clazz);
    input.setAttribute('size',size);
    input.setAttribute('id',id);
    input.setAttribute('name',id);
        input.setAttribute('value', value);
    return input;
}
/**
 * Build up an HTML HIDDEN tag
 * @param id REQUIRED - the id
 * @param value optional - default value
 * @param clazz optional - the css class
 * @return
 */
function buildHidden(id,value,size,clazz) {
    input =  document.createElement("HIDDEN");
    input.setAttribute('type','hidden');
    input.setAttribute('class',clazz);
    input.setAttribute('size',size);
    input.setAttribute('id',id);
    input.setAttribute('name',id);
    input.setAttribute('value', value);
    return input;
}
/**
 * Creates a span object
 * @return
 */
function buildSpan(id,value,clazz,style) {
    span = new Element('span', {
        'id': id,
        'class':clazz,
        'style': style
    });
    span.set('html',value);
    return span;
}
/**
 * Created specifically for my project - creates a delete image 
 * @return
 */
function buildRemoveImage() {
    image = new Element('img', {
        'src': '/images/delete-button.png',
        'width':'12',
        'height':'12'
    });
    return image;
}
/*************************************************************
 * END
 *************************************************************/

/**
 * Keep a count of the filters added. 
 */
var filters = 0;
function removeIt(id) {
	item = $(id);
    /**
     * I had to add this logic here to remove elements created by the datepicker, otherwise
     * every time you changed between the created on date and the date of birth field I was
     * getting a growing list of input fields. when they attach, they create a field and 
     * set the name and id to '' - but the parent also has other elements, namely an image
     * used to remove the filter, hence the check for !blanks.src
     */
	item.getParent().getChildren().each(function (blanks) {
		if (blanks.name == '' && blanks.id == '' && !blanks.src) {
			blanks.dispose();
		}
	});
}
/**
 * This is called when the user clicks the add filter button.
 * It will add a new div to do the filter row.
 */
 function addFilter() {
     filterOptions = $('filterOptions');
     wrapper=getWrapper('tDiv','filter'+filters);
     
     if (filters>0) {
         tandor=buildSelect('andor'+filters,andors);
         wrapper.appendChild(tandor);
     } else {
         tspan=buildSpan(null,'&nbsp;',null,'margin-left:52px;');
         wrapper.appendChild(tspan);
     }
     tcols=buildSelect('column'+filters,columns);
     // add an event to switch out the input box with drop down menue based
     // on the column
     tcols.addEvent('change',function (e) {
        e.stop();
        if (this.selectedIndex >=0 ) {
        		removeIt(this.id.replace("column","val"));
            switch (this.options[this.selectedIndex].value) {
                case "address_state" : { 
                    /*
                     * make the input be a populated select box
                     * take our id and replace the column with val to get the
                     * correct value element to replace
                     */ 
                    id = this.id.replace("column","val");
                    nval = buildSelect(id,states,'afilter');
                    nval.replaces(id);
                    break;
                }
                case "borough" : {
                    id = this.id.replace("column","val");
                    nval = buildSelect(id,boroughs,'afilter');
                    nval.replaces(id);
                    break;
                }
                case "status_employment" : { 
                    id = this.id.replace("column","val");
                    nval = buildSelect(id,employment,'afilter');
                    nval.replaces(id);
                    break;
                }
                case "race" : { 
                    id = this.id.replace("column","val");
                    nval = buildSelect(id,background,'afilter');
                    nval.replaces(id);
                    break;
                }
                case "status_marital" : { 
                    id = this.id.replace("column","val");
                    nval = buildSelect(id,marital,'afilter');
                    nval.replaces(id);
                    break;
                }
                case "income" : { 
                    id = this.id.replace("column","val");
                    nval = buildSelect(id,income,'afilter');
                    nval.replaces(id);
                    break;
                }
                case "gender" : { 
                    id = this.id.replace("column","val");
                    nval = buildSelect(id,gender,'afilter');
                    nval.replaces(id);
                    break;
                }
                case "degree_education" : { 
                    id = this.id.replace("column","val");
                    nval = buildSelect(id,education,'afilter');
                    nval.replaces(id);
                    break;
                }
                case "education" : { 
                    id = this.id.replace("column","val");
                    nval = buildSelect(id,education,'afilter');
                    nval.replaces(id);
                    break;
                }
                case "status_children" : { 
                    id = this.id.replace("column","val");
                    nval = buildSelect(id,children,'afilter');
                    nval.replaces(id);
                    break;
                }
                case "child_gender" : { 
                    id = this.id.replace("column","val");
                    nval = buildSelect(id,gender,'afilter');
                    nval.replaces(id);
                    break;
                }
                
                default : {
                    id = this.id.replace("column","val");
                    removeIt(id);
                    
                    nval = buildInput(id,'',20,'afilter');
                    nval.replaces(id);
                    nval.set('id',id);
                    nval.set('name',id);
                    if (this.options[this.selectedIndex].value == "YOB" || 
                        this.options[this.selectedIndex].value == "child_YOB" || 
                        this.options[this.selectedIndex].value == "time_submitted") {
                        new DatePicker(nval, {format: 'm/d/Y', inputOutputFormat: 'm/d/Y', yearPicker: true, allowEmpty: true, startView: 'decades'});
                    }
                    
                }
            }
        }
     });
     tcond=buildSelect('cond'+filters,conditions);
     tval=buildInput('val'+filters,'',20,'afilter');
     
     deleteItem=buildRemoveImage();
     deleteItem.addEvent('click', function(e) {
         e.stop();
         myParent = this.getParent();
         container = myParent.getParent();
         container.removeChild(myParent);
         myParent = null;
         kids = container.getChildren();
         if (kids.length>0) {
             // try and keep the index from getting too big...
             // not sure if its needed.
             re = /[0-9]+$/;
             el = kids[kids.length-1];
             theid = new Number(re.exec(el.id));
             filters = theid+1;
             return;
         }
         filters=0;
     });
     wrapper.appendChild(tcols);
     wrapper.appendChild(tcond);
     wrapper.appendChild(tval);
     wrapper.appendChild(deleteItem);
     filterOptions.appendChild(wrapper);
     filters++;
     new DatePicker(tval, {format: 'm/d/Y', inputOutputFormat: 'm/d/Y', yearPicker: true, allowEmpty: true, startView: 'decades'});
}
 /**
  * The function will take the options entered and add them to the datagrid
  * if and only if they entered a value. So, if they added a filter
  * but cleared out the value, it will not have an effect.
  * 
  * @return null
  */
function setFilters() {
    theFilters = $$('input.afilter');
    datagrid.clearFilters();
    theFilters.each(function (el, index) {
        if (el.value != '' && el.id != '') {
            re = /[0-9]+$/;
            theid = re.exec(el.id);
            index = theid[0];
            acol = $('column' + index);
            acond = $('cond' + index);
            andor = $('andor' + index);
            if (andor) {
                andor = andor.value;
            }
            col = acol.options[acol.selectedIndex].value;
            cond = acond.options[acond.selectedIndex].value;
            val = el.value;
            // only add the filter if there is a value
            if (val != "") {
                datagrid.addFilter(col,val,cond,andor,index);
            }
        }
    });
    theFilters = $$('select.afilter');
    theFilters.each(function (el, index) {
        if (el.selectedIndex >= 0) {
            re = /[0-9]+$/;
            theid = re.exec(el.id);
            index = theid[0];
            acol = $('column' + index);
            acond = $('cond' + index);
            andor = $('andor' + index);
            if (andor) {
                andor = andor.value;
            }
            col = acol.options[acol.selectedIndex].value;
            cond = acond.options[acond.selectedIndex].value;
            val = el.options[el.selectedIndex].value;
            // only add the filter if there is a value
            if (val != "") {
                    datagrid.addFilter(col,val,cond,andor,index);
            }
        }
    });
}
/**
 * Once a user has entered some filtering data, they can click
 * an "Apply Filter" button and this function gets called. 
 * We will set the filters and then refresh the datagrid.
 * 
 * @return null
 */
function applyFilters() {
    setFilters();
    datagrid.refresh();
}
/**
 * Set the action and post the form to get a csv file
 * @return
 */
function getCsv() {
    
    $('_action').value="csv";
    $('postit').getChildren().each( function(e) {
        if (e.id == '_action') 
            e.value="csv";
    });
    extras = datagrid.setParams();
  
    if (extras) {
      for (idx = 0; idx< extras.filterCount;idx++) {
        field = buildHidden('column'+idx,eval('extras.column'+idx),null,null);
        $('postit').appendChild(field);
        field = buildHidden('val'+idx,eval('extras.val'+idx),null,null);
        $('postit').appendChild(field);
        field = buildHidden('cond'+idx,eval('extras.cond'+idx),null,null);
        $('postit').appendChild(field);
        if (idx>0) {
          field = buildHidden('andor'+idx,eval('extras.andor'+idx),null,null);
          $('postit').appendChild(field);
        }
          
      }
    }
    $('postit').submit();
}
/**
 * When clicked will clear out the filters and refresh the data
 * @return
 */
function clearFilters() {
    datagrid.clearFilters();
    datagrid.refresh();
}
/**
 * Quick and dirty trim string function. It is recursive.
 * author: russellsimpkins@hotmail.com
 **/
function trim( str ) {
    if ( str.charAt(0) == " ")
        return trim( str.substr(1) );
    if ( str.charAt( str.length - 1 ) == " ")
        return trim( str.substr(0, str.length - 2) );
    return str;
}

/**
 * http://phpjs.org/functions/ucwords:569
 */
function ucwords(str) {
    // Uppercase the first character of every word in a string  
    // 
    // version: 1001.2911
    // discuss at: http://phpjs.org/functions/ucwords
    // +   original by: Jonas Raoni Soares Silva (http://www.jsfromhell.com)
    // +   improved by: Waldo Malqui Silva
    // +   bugfixed by: Onno Marsman
    // +   improved by: Robin
    // *     example 1: ucwords('kevin van zonneveld');
    // *     returns 1: 'Kevin Van Zonneveld'
    // *     example 2: ucwords('HELLO WORLD');
    // *     returns 2: 'HELLO WORLD'
    return (str + '').replace(/^(.)|\s(.)/g, function ($1) {
        return $1.toUpperCase();
    });
}
/**
 * Make a row in an html form using the grid data definition.
 * @param el
 * @return
 */
function makeRow(el,data) {
    nel = new Element("div", {
        'class':'editRow'
    });
    label = new Element("div", {
        'class':'label'
    });
    label.set('html',el.header + ":");

    inputField = new Element("div", {
        'class':'inputField'
    });
    var input;
    var val = data.get(el.dataIndex);
    
    // prevent the word null from showing up.
    if (val == "null" || val == null) val = '';
        
    // should we use some type of input field or just a span
    if (el.editable) {
        switch (el.dataType) {
            case 'date': {
                // todo - add value
                input = buildInput(el.dataIndex,val,20,'DatePickers');
                break;
            }
            default: {
                // todo - add value
                input = buildInput(el.dataIndex,val,30);
                break;
            }
        }
        switch (el.dataIndex) {
            case "address_state" : { 
                /*
                 * make the input be a populated select box
                 * take our id and replace the column with val to get the
                 * correct value element to replace
                 */ 
                input = buildSelect(el.dataIndex,states,null,val);
                break;
            }
            case "status_employment" : { 
                input = buildSelect(el.dataIndex,employment,null,val);
                break;
            }
            case "race" : { 
                input = buildSelect(el.dataIndex,background,null,val);
                break;
            }
            case "income" : { 
                input = buildSelect(el.dataIndex,income,null,val);
                break;
            }
            case "gender" : { 
                input = buildSelect(el.dataIndex,gender,null,val);
                break;
            }
            case "degree_education" : { 
                input = buildSelect(el.dataIndex,education,null,val);
                break;
            }
            case "education" : { 
                input = buildSelect(el.dataIndex,education,null,val);
                break;
            }
            case "status_children" : {
                input = buildSelect(el.dataIndex, children, null, val);
                break;
            }
        }
    } else {
        input = buildSpan(null,val,null,null);        
    }
    inputField.appendChild(input);
    if (el.pk) {
        pk = buildInput(el.dataIndex,val,30);
        pk.setAttribute('type','hidden');
        inputField.appendChild(pk);
    }
    // you may have to vary this depending on your own css...
    nel.appendChild(inputField);
    nel.appendChild(label);
    return nel;
}
/**
 * Create an empty model based on the cmu data structure
 */
function getEmptyModel() {
    target = new Hash();
    cmu.each(function(def) {
        target[def.dataIndex]='';
    });
    return target;
}
/**
 * This here is app specific. Given how omnigrid works, I 
 * was forced to bring back duplicates to return the related
 * child data. Anyway, the child data are defined in cmu and
 * all start with child_
 * @return
 */
function getEmptyChildModel() {
    model = [];
    cmu.each(function(def) {
        if (def.dataIndex.match(/^child_/)) {
            target = new Hash();
            target['dataIndex'] = def.dataIndex.replace(/^child_/,"");
            target['editable'] = true;
            target['dataType'] = def.dataType;
            target['header'] = def.header;
            if (def.pk)
                target['pk'] = def.pk;
            if (def.width)
                target['width'] = def.width;
            model[model.length]=target;
        }
    });
    target = new Hash();
    target['dataIndex'] = 'parent_id';
    target['editable'] = false;
    target['dataType'] = 'number';
    target['header'] = 'Submission ID';
    target['pk'] = true;
    model[model.length]=target;
    return model;
}
/**
 * This will create a hash with just the child data
 * @param data
 * @return
 */
function getChildData(data) {
    target = new Hash();
    cmu.each(function(def) {
        if (def.dataIndex.match(/^child_/)) {
            target[def.dataIndex.replace(/^child_/,"")] = data[def.dataIndex];
        }
    });
    return target;
}
/**
 *  here are our fields. you need to define your fields for omnigrid
 *  I added editable and pk
 *  if editable == true it will be there in an input field
 *  if not, it will be there in a hidden field and in a span.
 */
var cmu = [
{
    dataIndex: 'id',
    dataType: 'number',
    editable: false,
    pk: true,
    header: 'Record ID'
 },
{
    dataIndex: 'time_submitted',
    dataType: 'date',
    editable: false,
    header: 'Date Created',
    width: 150
 },
{
    dataIndex: 'name_first',
    dataType: 'string',
    editable: true,
    header: 'First name',
    width: 100
 },
{
    dataIndex: 'name_last',
    dataType: 'string',
    editable: true,
    header: 'Last name',
    width: 150
 },
{
    dataIndex: 'address_main',
    dataType: 'string',
    editable: true,
    header: 'Address 1' 
 },
{
    dataIndex: 'address_secondary',
    dataType: 'string',
    editable: true,
    header: 'Address 2' 
 },
{
    dataIndex: 'address_city',
    dataType: 'string',
    editable: true,
    header: 'City' 
 },
{
    dataIndex: 'address_state',
    dataType: 'string',
    editable: true,
    header: 'State' 
 },
{
    dataIndex: 'address_zip',
    dataType: 'string',
    editable: true,
    header: 'Zipcode' 
 },
{
    dataIndex: 'telephone_number',
    dataType: 'string',
    editable: true,
    header: 'Phone number' 
 },
{
    dataIndex: 'email',
    dataType: 'string',
    editable: true,
    header: 'Email' 
 },
{
    dataIndex: 'gender',
    dataType: 'string',
    editable: true,
    header: 'Gender' 
 },
{
    dataIndex: 'status_employment',
    dataType: 'string',
    editable: true,
    header: 'Employment Status' 
 },
{
    dataIndex: 'job_title',
    dataType: 'string',
    editable: true,
    header: 'Job Title' 
 },
{
    dataIndex: 'YOB',
    dataType: 'date',
    editable: true,
    header: 'Date of Birth'
 },
{
    dataIndex: 'race',
    dataType: 'string',
    editable: true,
    header: 'Race' 
 },
{
    dataIndex: 'status_marital',
    dataType: 'string',
    editable: true,
    header: 'Marital Status' 
 },
{
    dataIndex: 'degree_education',
    dataType: 'string',
    editable: true,
    header: 'Education Level' 
 },
{
    dataIndex: 'income',
    dataType: 'number',
    editable: true,
    header: 'Income'
 },
 {
    dataIndex: 'status_children',
    dataType: 'string',
    editable: true,
    header: 'Children'
 }
 ,
 {
     dataIndex: 'child_id',
     dataType: 'number',
     editable: false,
    header: 'Children Record ID'
 }
 ,
 {
     dataIndex: 'child_YOB',
     dataType: 'date',
     editable: false,
    header: 'Child\'s Date of birth'
 }
 ,
 {
     dataIndex: 'child_gender',
     dataType: 'string',
     editable: false,
    header: 'Child\'s Gender'
 }
];


var employment = new Hash();
employment["Employed Full-Time"]="Employed Full-Time";
employment["Employed Part-Time"]="Employed Part-Time";
employment["Stay-at-home Mom"]="Stay-at-home Mom";
employment["Unemployed"]="Unemployed";
employment["Retired"]="Retired";
var gender = new Hash();
gender["M"]="Male";
gender["F"]="Female";
var children = new Hash();
children['']='';
children['Yes']='Yes';
children['No']='No';
var background = new Hash();
background["White/Caucasian"]="White/Caucasian";
background["Black/African-American"]="Black/African-American";
background["Hispanic/Latino"]="Hispanic/Latino";
background["Asian/Pacific Islander"]="Asian/Pacific Islander";
background["Middle Eastern"]="Middle Eastern";
background["Native American"]="Native American";
background["Other Background"]="Other";
var marital = new Hash();
marital["Single"]="Single";
marital["Single in relationship/engaged"]="Single in relationship/engaged";
marital["Married"]="Married";
marital["Divorced"]="Divorced";
marital["Separated"]="Separated";
marital["Widowed"]="Widowed";
var education = new Hash();
education["Less than High School"]="Less than High School";
education["High School Graduate"]="High School Graduate";
education["Post High School Vocational or Technical School"]="Post High School Vocational or Technical School";
education["Some College"]="Some College";
education["Two Year College Graduate"]="Two Year College Graduate";
education["Four Year College Graduate"]="Four Year College Graduate";
education["Post Graduate Degree"]="Post Graduate Degree";
var income = new Hash();
income["25000"]="Below $25,000";
income["29999"]="$25,000 TO $29,999";
income["39999"]="$30,000 TO $39,999";
income["49999"]="$40,000 TO $49,999";
income["59999"]="$50,000 TO $59,999";
income["69999"]="$60,000 TO $69,999";
income["79999"]="$70,000 TO $79,999";
income["89999"]="$80,000 TO $89,999";
income["99999"]="$90,000 TO $99,999";
income["149999"]="$100,000 TO $149,999";
income["199999"]="$150,000 TO $199,999";
income["200000"]="$200,000 or Higher";
var states = new Hash();
states["AL"]="Alabama";
states["AK"]="Alaska";
states["AZ"]="Arizona";
states["AR"]="Arkansas";
states["CA"]="California";
states["CO"]="Colorado";
states["CT"]="Connecticut";
states["DE"]="Delaware";
states["FL"]="Florida";
states["GA"]="Georgia";
states["HI"]="Hawaii";
states["ID"]="Idaho";
states["IL"]="Illinois";
states["IN"]="Indiana";
states["IA"]="Iowa";
states["KS"]="Kansas";
states["KY"]="Kentucky";
states["LA"]="Louisiana";
states["ME"]="Maine";
states["MD"]="Maryland";
states["MA"]="Massachusetts";
states["MI"]="Michigan";
states["MN"]="Minnesota";
states["MS"]="Mississippi";
states["MO"]="Missouri";
states["MT"]="Montana";
states["NE"]="Nebraska";
states["NV"]="Nevada";
states["NH"]="New Hampshire";
states["NJ"]="New Jersey";
states["NM"]="New Mexico";
states["NY"]="New York";
states["NC"]="North Carolina";
states["ND"]="North Dakota";
states["OH"]="Ohio";
states["OK"]="Oklahoma";
states["OR"]="Oregon";
states["PA"]="Pennsylvania";
states["RI"]="Rhode Island";
states["SC"]="South Carolina";
states["SD"]="South Dakota";
states["TN"]="Tennessee";
states["TX"]="Texas";
states["UT"]="Utah";
states["VT"]="Vermont";
states["VA"]="Virginia";
states["WA"]="Washington";
states["DC"]="Washington DC";
states["WV"]="West Virginia";
states["WI"]="Wisconsin";
states["WY"]="Wyoming";
var boroughs = new Hash();
boroughs['Bronx'] = 'Bronx'; 
boroughs['Brooklyn'] = 'Brooklyn'; 
boroughs['Manhattan'] = 'Manhattan'; 
boroughs['Queens'] = 'Queens'; 
boroughs['Staten Island'] = 'Staten Island'; 

//columns for sql where clause
var columns = new Hash();
columns['time_submitted']='Created date';
columns['name_first']='First Name';
columns['name_last']='Last Name';
columns['address_main']='Address';
columns['address_secondary']='Address 2';
columns['address_city']='City';
columns['address_state']='State';
columns['address_zip']='Zip';
columns['borough']='Borough';
columns['telephone_number']='Telephone Number';
columns['email']='Email Address';
columns['gender']='Gender';
columns['status_employment']='Employment Status';
columns['job_title']='Job Title';
columns['YOB']='Date of birth';
columns['race']='Race';
columns['status_marital']='Marital Status';
columns['degree_education']='Degree';
columns['income']='Income Range';
columns['status_children']='Has Children';
columns['child_YOB']='Child\'s date of birth';
columns['child_gender']='Child\'s gender';

// for our sql search conditions
var conditions = new Hash();
conditions['=']='matches exactly';
conditions['n%']='starts with';
conditions['%n']='ends with';
conditions['%n%']='contains';
conditions['lt']='less than';
conditions['lt=']='less than or equal to';
conditions['gt']='greater than';
conditions['gt=']='greater than or equal to';

// for adding additional params.
var andors = new Hash();
andors['and']='and';
andors['or']='or';

// add the datagrid after the browser has loaded.
window.addEvent("domready", function() {

    datagrid = new omniGrid('mygrid', {
        columnModel: cmu,
        buttons : null,
        
        buttons : [
          //{name: 'Add', bclass: 'add', onclick : gridButtonClick},
          {name: 'Delete', bclass: 'delete', onclick : deleteSelectedRow},
          {separator: true}
          //{name: 'Duplicate', bclass: 'duplicate', onclick : gridButtonClick}
        ],
        
        url:"/cms/action/actionSubmission.php",
        childUrl:"/cms/action/actionChildren.php",
        perPageOptions: [10,20,50],
        perPage:20,
        page:1,
        pagination:true,
        serverSort:true,
        showHeader:true,
        alternaterows:true,
        sortHeader:true,
        resizeColumns:true,
        multipleSelection:true,

        // uncomment this if you want accordion behavior for every row
        /**/
        accordion:true,
        accordionRenderer:showEditForm,
        autoSectionToggle:false,
        

        width:1200,
        height:500
    });

    datagrid.addEvent('click', onGridSelect);
    $('addFilter').addEvent('click', addFilter);
    $('doclear').addEvent('click', clearFilters);
    
    //prompt('',JSON.encode(getEmptyChildModel()));
});
