<?php
/**
 * Service.class.php  
 *
 * @version $Id$
 * @package User
 */
nytd_require('NYTD/Logger/Web.class.php');
nytd_require('NYTD/User/Constants.class.php');
nytd_require('NYTD/User/Response.class.php');
nytd_require('NYTD/User/Error.class.php');
nytd_require('NYTD/User/DAO.class.php');
nytd_require('NYTD/User/Manager.class.php');
nytd_require('NYTD/User/OAuthManager.class.php');
nytd_require('NYTD/User/Record.class.php');
nytd_require('NYTD/User/Validator.class.php');

class NYTD_User_Service {
    /**
     * this will dictate response format. For now we'll only do json.
     * @var sting
     */
	 private $action;
	 private $params;

    public function __construct() {
		$this->logger = NYTD_Logger_Web::getInstance('user');
		$this->logger->setLevel(255);

		// $this->logger->debug("Request Method is: " . $_SERVER['REQUEST_METHOD']);
		
		switch ($_SERVER['REQUEST_METHOD']) {
			case 'GET':
				$this->action = 'Read';
				$this->params = & $_GET;
				break;
			case 'PUT':
				$this->action = 'Update';
				$this->params = & $_POST; 
				break;
			 case 'POST':
				$this->action = 'Create';
				$this->params = & $_POST;
				break;
		}
	}

	public function run() {
	    $mgr = null;
	    // add new calls in this switch block.
	    switch ($_SERVER['REQUEST_URI']) {
	        case "/svc/user/mobile/auth" : 
	            $mgr = new NYTD_OAuth_Manager($this->action, $this->params);
	            break;
	        case "/svc/user/auth" : 
                $mgr = new NYTD_OAuth_Manager($this->action, $this->params);
                break;
	        // default is "/svc/user/mobile" : 
	        default : 
	            $mgr = new NYTD_User_Manager($this->action, $this->params);
	    }
	    
    		$result = $mgr->handleRequest();
    		return new NYTD_User_Response($result);
    		
	}

} // end of class

?>
