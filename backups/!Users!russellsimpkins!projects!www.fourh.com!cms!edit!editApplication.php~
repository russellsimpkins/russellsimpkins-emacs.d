<?php
/**
 * Russell Simpkins Software License
 *
 * Copyright Russell Simpkins 2010.  All rights reserved.
 * THIS PROGRAM IS AN UNPUBLISHED WORK AND TRADE SECRET OF THE COPYRIGHT HOLDER,
 * AND DISTRIBUTED ONLY UNDER RESTRICTION.
 *
 * No part of this program may be used, installed, displayed, reproduced,
 * distributed or modified without the express written consent of the copyright
 * holder.
 *
 * EXCEPT AS EXPLICITLY STATED IN A WRITTEN AGREEMENT BETWEEN THE PARTIES,
 * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
 * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED.  IN NO EVENT SHALL Russell Simpkins OR
 * ITS CONTRIBUTORS OR EMPLOYEES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
 * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * @author <a href='mailto:russellsimpkins@hotmail.com'>Russell Simpkins</a>
 *
 */
$path = "../";
include_once($path . "inc/global.inc.php");
$staticPath = BASE_SITE_PATH . "cms/";
if ( SECURE ) {
    include_once($path . "inc/secure.php");
}
require_once($path . "classes/Application.class.php");
$vars = array_merge($_GET,$_POST);
$objApplication = new Application();
if (!empty($vars['application_id'])) {
    $id = is_array($vars['application_id']) ? $vars['application_id'][0] : $vars['application_id'];
	$objApplication->loadById($id);
    $title = "Edit";
} else {
    $title = "Add";
}
/**
 * This function builds a dropdown of all files in a folder
 * and builds a set of <options> for a select form
 **/
function buildFileDropdown( $path, $selected ) {
	if (!file_exists($path)) {
		$rval = '<option value="">no files uploaded yet</option>';
		echo $rval;
		return;
	}
    $d = dir($path);
    $rval = "";
    while($entry = $d->read()) {
        if ($entry != "." && $entry != "..") {
            if (is_dir($path . "/" . $entry)) {
                #getDirList($path ."/". $entry);
            } else {
                $rval .= '<option value="' . $entry . '"';
                if ( $selected == $entry ) {
                    $rval .= " selected ";
                    $sel = true;
                }
                $rval .= ">" . $entry . "</option>";
            }
        }
    }
    if ( strlen( $rval ) > 5 ) {
        $rval = '<option value="">select existing</option>' . $rval;
    } else {
        $rval = '<option value="">no files uploaded yet</option>' . $rval;
    }
    $d->close();
    echo $rval;
}
?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title><?=$title?> Application </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="<?=$staticPath?>css/site.css" rel="stylesheet" type="text/css">
<script language="javascript" type="text/javascript" src="<?=$staticPath?>js/calendar.js"></script>
<script language="javascript" type="text/javascript" src="<?=$staticPath?>js/common.js"></script>
</head>
<body>
<div id="wrapper" class="wrapper">
<?php include_once($path . "inc/branding.bar.inc.php"); ?>
<?php include_once($path . "inc/admin-leftnav.inc.php"); ?>
<div id="header" class="headerblock">
    <table width="539" border="0" cellpadding="0" cellspacing="0" class="singleheaderform">
        <tr>
            <td class="singleheader"><a href="<?=$staticPath?>edit/editApplication.php"><img src="<?=$staticPath?>img/new.png" border="0" width="16" height="16" alt="add new Application" title="add new Application"></a>&nbsp;&nbsp;<?=$title?> Application</td>
            <td>&nbsp;</td>
        </tr>
		<tr><td class="spacer" colspan="2"><img src="<?=$staticPath?>img/spacer.gif" width="539" height="1"></td></tr>
    </table>
</div>
<div class="editblock" id="formdata">
<form enctype="multipart/form-data" name="editApplication" method="post" action="../save/saveApplication.php" class="searchdata">
<table class="editform" width="600" border="0" cellspacing="0" cellpadding="0">
<tr><td class="spacer" colspan="3"><img src="<?=$staticPath?>img/spacer.gif" width="539" height="1"></td></tr>
<tr>
    <td align="right" class="editform-field"><img src="<?=$staticPath?>img/spacer.gif" width="115" height="1" /></td>
    <td><img src="<?=$staticPath?>img/spacer.gif" width="5" height="1" /></td>
    <td><img src="<?=$staticPath?>img/spacer.gif" width="480" height="1" />
        <input type="hidden" name="application_id" value="<?=$objApplication->getApplicationId()?>">
    </td>
</tr>
<tr>
    <td align="center" colspan="3" class="blkText">
    <?php if (!empty($vars['application_id'])) {?>
        <strong>Duplicate:</strong> <input type="checkbox" name="duplicate" value="1">
    <?php } ?>
        <input type="submit" value="save" vspace="10" class="save-button" />&nbsp;</td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>First Name:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="first_name" maxlength="255" value="<?=$objApplication->getFirstName()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Middle Initial:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="middle_initial" maxlength="255" value="<?=$objApplication->getMiddleInitial()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Last Name:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="last_name" maxlength="255" value="<?=$objApplication->getLastName()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>My Title:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="my_title" maxlength="255" value="<?=$objApplication->getMyTitle()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Dob:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="dob" maxlength="255" value="<?=$objApplication->getDob()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Gender:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="gender" maxlength="255" value="<?=$objApplication->getGender()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Job Title:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="job_title" maxlength="255" value="<?=$objApplication->getJobTitle()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Company Name:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="company_name" maxlength="255" value="<?=$objApplication->getCompanyName()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Street:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="street" maxlength="255" value="<?=$objApplication->getStreet()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>City:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="city" maxlength="255" value="<?=$objApplication->getCity()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Contact Last Name:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="contact_last_name" maxlength="255" value="<?=$objApplication->getContactLastName()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>State:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="state" maxlength="255" value="<?=$objApplication->getState()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Zipcode:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="zipcode" maxlength="255" value="<?=$objApplication->getZipcode()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Email:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="email" maxlength="255" value="<?=$objApplication->getEmail()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Telephone:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="telephone" maxlength="20" value="<?=$objApplication->getTelephone()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Mobile Phone:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="mobile_phone" maxlength="20" value="<?=$objApplication->getMobilePhone()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Work Phone:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="work_phone" maxlength="20" value="<?=$objApplication->getWorkPhone()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Cardtype Ops:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="cardtype_ops" maxlength="255" value="<?=$objApplication->getCardtypeOps()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Credit Card Number:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="credit_card_number" maxlength="255" value="<?=$objApplication->getCreditCardNumber()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Security Code:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="security_code" maxlength="255" value="<?=$objApplication->getSecurityCode()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Exp Day:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="exp_day" maxlength="2" value="<?=$objApplication->getExpDay()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Exp Month:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="exp_month" maxlength="30" value="<?=$objApplication->getExpMonth()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Exp Year:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="exp_year" maxlength="4" value="<?=$objApplication->getExpYear()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Billing Address:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="text" name="billing_address" maxlength="255" value="<?=$objApplication->getBillingAddress()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="right" class="blkText"><b>Passwd:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="password" name="passwd" maxlength="255" value="" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<?php if ( !empty( $objApplication->pictureFilename ) && strlen($objApplication->pictureFilename) >0) { ?>
<tr>
    <td align="right" class="blkText"><b>Delete existing Picture file:</b></td>
    <td>&nbsp;</td>
    <td><input type="checkbox" name="delete_picture_filename" value="1">
    <a target="_blank" class="blkText" href="<?=FILE_PREV_PATH . 'application/' . $objApplication->getApplicationId() . "/" .  $objApplication->getPictureFilename()?>">preview</a>
    <select name="picture_filename" id="picture_filename" class="editform-field">
    <?php
    buildFileDropdown( FILE_UL_PATH . 'application/' . $objApplication->getApplicationId() . '/', $objApplication->getPictureFilename() );
    ?>
    </select>&nbsp;&nbsp;<a href="editFlatFile.php?class=Application&field=pictureFilename&id=<?=$objApplication->getApplicationId()?>" class="blkText">file editor</a>
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<?php } else { ?>
<tr>
    <td align="right" class="blkText"><b>Select Picture file:</b></td>
    <td>&nbsp;</td>
    <td>
    <select name="picture_filename" id="picture_filename"  class="editform-field">
    <?php
    buildFileDropdown( FILE_UL_PATH . 'application/' . $objApplication->getApplicationId() . '/', $objApplication->getPictureFilename() );
    ?>
    </select>
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<?php } ?>
<tr>
    <td align="right" class="blkText"><b>Upload Picture file:</b></td>
    <td>&nbsp;</td>
    <td>
    <input type="file" name="new_picture_filename" value="<?=$objApplication->getPictureFilename()?>" size="30" class="editform-field">
    </td>
</tr>
<tr><td colspan="3" class="editform-spacer"><img src="<?=$staticPath?>img/spacer.gif" height="1"></td></tr>
<tr>
    <td align="center" colspan="3" class="blkText"><input type="submit" value="save" vspace="10" class="save-button" />&nbsp;</td>
</tr>
<tr><td class="spacer" colspan="3"><img src="<?=$staticPath?>img/spacer.gif" width="539" height="1"></td></tr>
<tr>
    <td align="center" colspan="3" class="lightrow">&nbsp;</td>
</tr>
</table>
</form>
</div>
<div class="instructionblock" id="instructions"> 
    <table class="instructionform" border="0" cellpadding="0" cellspacing="0">
        <tr> 
            <td align="left" valign="top"><p>This is an edit/add screen. Use this screen to create or edit
            Application assets.</p></td>
        </tr>
    </table>
</div>
</div>
</html>
